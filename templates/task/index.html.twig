{# templates/task/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Tasks{% endblock %}

{% block body %}
<div class="container-fluid mt-4">

  <!-- Page Header -->
  <div class="row align-items-center g-3 mb-3">
    <div class="col-12 col-lg-3 d-flex align-items-center gap-2">
      <h1 class="h3 m-0 d-flex align-items-center gap-2" style="font-size:1.6rem;">
        <i class="bi bi-check2-square text-primary"></i> Tasks
      </h1>
    </div>

    <div class="col-12 col-lg-4">
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input id="taskSearch" type="search" class="form-control"
               placeholder="Search tasks... (title, status, due)">
      </div>
    </div>

    <div class="col-12 col-lg-5 d-flex justify-content-lg-end gap-2">
      <a href="{{ path('task_new') }}" class="btn btn-primary">
        <i class="bi bi-plus-circle me-1"></i> New Task
      </a>

      <a href="{{ path('task_trash') }}" class="btn btn-outline-secondary">
        <i class="bi bi-trash3 me-1"></i> Trash
      </a>
    </div>
  </div>

  <!-- Tasks Card -->
  <div class="row">
    <div class="col-12">
      <div class="card bg-body shadow-sm w-100">
        <div class="card-body p-0">

          <div class="table-responsive">
            <table id="taskTable" class="table mb-0 table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th style="width: 80px;">ID</th>
                  <th>Title</th>
                  <th style="width: 140px;">Status</th>
                  <th style="width: 190px;">Due</th>
                  <th class="text-end" style="width: 180px;">Actions</th>
                </tr>
              </thead>

              <tbody>
              {% for task in pagination %}
                <tr>
                  <td>{{ task.id }}</td>
                  <td>
                    <a class="text-decoration-none fw-semibold"
                       href="{{ path('task_show', {id: task.id}) }}">
                      {{ task.title }}
                    </a>
                  </td>
                  <td>
                    <span class="badge {{ task.isDone ? 'bg-success' : 'bg-warning text-dark' }}">
                      {{ task.isDone ? 'Completed' : 'Pending' }}
                    </span>
                  </td>
                  <td>{{ task.dueAt ? task.dueAt|date('Y-m-d H:i') : 'â€”' }}</td>
                  <td class="text-end">
                    <a class="btn btn-sm btn-secondary" href="{{ path('task_edit', {id: task.id}) }}">
                      <i class="bi bi-pencil"></i>
                    </a>

                    <form method="post" action="{{ path('task_delete', {id: task.id}) }}"
                          class="d-inline" onsubmit="return confirm('Move to trash?');">
                      <input type="hidden" name="_token" value="{{ csrf_token('delete_task_' ~ task.id) }}">
                      <button class="btn btn-sm btn-danger">
                        <i class="bi bi-trash3"></i>
                      </button>
                    </form>

                    <form method="post" action="{{ path('task_toggle', {id: task.id}) }}" class="d-inline">
                      <button class="btn btn-sm btn-outline-info">
                        <i class="bi bi-repeat"></i>
                      </button>
                    </form>
                  </td>
                </tr>
              {% else %}
                <tr>
                  <td colspan="5" class="text-center text-muted py-4">No tasks yet.</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Pagination controls -->
          <nav aria-label="Page navigation" class="p-3 d-flex justify-content-center">
            {{ knp_pagination_render(pagination) }}
          </nav>
        </div>
      </div>
    </div>
  </div>

</div>

{# ðŸ”Ž Search script #}
<script>
  (function () {
    const input = document.getElementById('taskSearch');
    const tbody = document.querySelector('#taskTable tbody');
    if (!input || !tbody) return;

    input.addEventListener('input', function () {
      const filter = this.value.trim().toLowerCase();
      tbody.querySelectorAll('tr').forEach(row => {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
      });
    });
  })();
</script>

{# Page-scoped styling to enlarge table and spacing #}
<style>
  /* Wider feel on large screens */
  @media (min-width: 992px) {
    .container-fluid { padding-left: 2rem; padding-right: 2rem; }
  }

  /* Make table text larger and rows taller */
  #taskTable { font-size: 1.08rem; }          /* increase to 1.12â€“1.15 if needed */
  #taskTable td, #taskTable th { padding: .9rem 1rem; }

  /* No cramping in last column; title can wrap */
  #taskTable th:last-child, #taskTable td:last-child { white-space: nowrap; width: 180px; }
  #taskTable th:nth-child(2), #taskTable td:nth-child(2) { white-space: normal; }

  /* Slightly bolder header */
  #taskTable thead th { font-weight: 600; }
</style>
{% endblock %}
